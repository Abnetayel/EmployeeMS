@model WebApplication3.Models.Employe
@{
    ViewData["Title"] = "Create Employee";
}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-9">
            <div class="card border-0 shadow">
                <div class="card-header bg-success text-white py-3">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-user-plus fa-lg me-3"></i>
                        <h4 class="mb-0">@ViewData["Title"]</h4>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form asp-action="Create" id="employeeForm" class="needs-validation" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <!-- Full Name -->
                        <div class="mb-4">
                            <label asp-for="FullName" class="form-label fw-bold">Full Name <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user"></i></span>
                                <input asp-for="FullName" class="form-control form-control-lg" placeholder="Enter full name" required />
                            </div>
                            <span asp-validation-for="FullName" class="text-danger small"></span>
                        </div>

                        <!-- Age and Experience Row -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="Age" class="form-label fw-bold">Age <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                                    <input asp-for="Age" class="form-control" type="number" min="18" max="70" placeholder="Enter age" required />
                                </div>
                                <span asp-validation-for="Age" class="text-danger small"></span>
                                <div class="form-text">Must be between 18-70 years</div>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Experience" class="form-label fw-bold">Experience (Years) <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-briefcase"></i></span>
                                    <input asp-for="Experience" class="form-control" type="number" min="0" max="50" placeholder="Years of experience" required />
                                </div>
                                <span asp-validation-for="Experience" class="text-danger small"></span>
                                <div class="form-text">Years of professional experience</div>
                            </div>
                        </div>

                        <!-- Date of Registration -->
                        <div class="mb-4">
                            <label asp-for="DateOfRegistration" class="form-label fw-bold">Date of Registration <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                <input asp-for="DateOfRegistration" class="form-control" type="date" required />
                            </div>
                            <span asp-validation-for="DateOfRegistration" class="text-danger small"></span>
                        </div>

                        <!-- Education and Gender Row -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="Education" class="form-label fw-bold">Education Level <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-graduation-cap"></i></span>
                                    <select asp-for="Education" class="form-select" required>
                                        <option value="" selected disabled>-- Select Education --</option>
                                        <option value="HighSchool">High School</option>
                                        <option value="PhD">PhD</option>
                                        <option value="Bachelor">Bachelor</option>
                                        <option value="Master">Master</option>
                                        <option value="Other">Other (Specify)</option>
                                    </select>
                                </div>
                                <span asp-validation-for="Education" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Gender" class="form-label fw-bold">Gender <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
                                    <select asp-for="Gender" class="form-select" required>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <span asp-validation-for="Gender" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Skills -->
                        <div class="mb-4">
                            <label asp-for="Skills" class="form-label fw-bold">Primary Skill <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-code"></i></span>
                                <select asp-for="Skills" class="form-select" required>
                                    <optgroup label="Development Roles">
                                        <option value="Frontend">Frontend Developer</option>
                                        <option value="Backend">Backend Developer</option>
                                        <option value="Fullstack">Fullstack Developer</option>
                                        <option value="Mobile">Mobile Developer</option>
                                    </optgroup>
                                    <optgroup label="Specializations">
                                        <option value="Machine Learning">Machine Learning Engineer</option>
                                        <option value="DevOps">DevOps Engineer</option>
                                        <option value="Cloud">Cloud Architect</option>
                                    </optgroup>
                                </select>
                            </div>
                            <span asp-validation-for="Skills" class="text-danger small"></span>
                            <div class="form-text">Select your primary professional skill</div>
                        </div>

                        <!-- Employment Type and Country Row -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="EmployementType" class="form-label fw-bold">Employment Type <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-user-tie"></i></span>
                                    <select asp-for="EmployementType" class="form-select" required>
                                        <option value="" selected disabled>Select Employment Type</option>
                                        <option value="Full-time">Full-time</option>
                                        <option value="Part-time">Part-time</option>
                                        <option value="Contract">Contract</option>
                                        <option value="Freelance">Freelance</option>
                                    </select>
                                </div>
                                <span asp-validation-for="EmployementType" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Country" class="form-label fw-bold">Country <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-globe"></i></span>
                                    <select asp-for="Country" asp-items="ViewBag.Countries" class="form-select" required>
                                        <option value="" selected disabled>-- Select Country --</option>
                                    </select>
                                </div>
                                <span asp-validation-for="Country" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Phone Number and Currency Row -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label asp-for="PhoneNumber" class="form-label fw-bold">Phone Number <span class="text-danger">*</span></label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                    <input asp-for="PhoneNumber" class="form-control" placeholder="Enter phone number" required />
                                </div>
                                <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                            </div>
                            @* <div class="col-md-6"> *@
                            @*     <label asp-for="Currency" class="form-label fw-bold">Currency <span class="text-danger">*</span></label> *@
                            @*     <div class="input-group"> *@
                            @*         <span class="input-group-text"><i class="fas fa-money-bill-wave"></i></span> *@
                            @*         <select asp-for="Currency" class="form-select" required> *@
                            @*             <option value="USD">US Dollar ($)</option> *@
                            @*             <option value="GBP">British Pound (£)</option> *@
                            @*             <option value="EUR">Euro (€)</option> *@
                            @*             <option value="ETB">Ethiopian Birr (Br)</option> *@
                            @*             <option value="JPY">Japanese Yen (¥)</option> *@
                            @*         </select> *@
                            @*     </div> *@
                            @*     <span asp-validation-for="Currency" class="text-danger small"></span> *@
                            @* </div> *@
                        </div>



                        <!-- Manager Assignment -->
                        <div class="mb-4">
                            <label asp-for="ManagerId" class="form-label fw-bold">Assign Manager</label>
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-user-shield"></i></span>
                                <select asp-for="ManagerId" asp-items="ViewBag.Users" class="form-select">
                                    <option value="">-- Auto-assign to me (current user) --</option>
                                </select>
                            </div>
                            <span asp-validation-for="ManagerId" class="text-danger small"></span>
                            <div class="form-text">Leave blank to assign to yourself</div>
                        </div>



                        <!-- Salary with Prediction -->
                        <div class="mb-4">
                            <label asp-for="Salary" class="form-label fw-bold">Salary Amount <span class="text-danger">*</span></label>
                            <div class="input-group mb-2">
                                <span class="input-group-text"><i class="fas fa-dollar-sign"></i></span>
                                <input asp-for="Salary" class="form-control" type="number" step="0.01" placeholder="Enter salary amount" id="salaryInput" required />
                                <button type="button" class="btn btn-primary" id="predictSalaryBtn">
                                    <i class="fas fa-calculator me-2"></i> Predict Salary
                                </button>
                            </div>
                            @* <span asp-validation-for="Salary" class="text-danger small"></span> *@
                            @* <div id="predictionInfo" class="alert alert-info mt-2 d-flex align-items-center" style="display: none!important;"> *@
                            @*     <i class="fas fa-info-circle me-2"></i> *@
                            @*     <span></span> *@
                            @* </div> *@
                            <span asp-validation-for="Salary" class="text-danger"></span>
                            <div id="predictionInfo" class="text-info mt-2"></div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between mt-5">
                            <button type="submit" class="btn btn-success btn-lg px-4">
                                <i class="fas fa-plus-circle me-2"></i> Add Employee
                            </button>
                            <div>
                                <a asp-action="Index" class="btn btn-outline-secondary me-2">
                                    <i class="fas fa-list me-2"></i> Back to List
                                </a>
                                 <a asp-action="Predict" class="btn btn-outline-primary"> 
                                     <i class="fas fa-chart-line me-2"></i> Go to Predict 
                                 </a> 
                                <a asp-action="AssignEmployees" asp-controller="Admin" class="btn btn-outline-primary">
                                    <i class="fas fa-chart-line me-2"></i> go to assign
                                </a>
                                <a asp-action="PreprocessDataView" asp-controller="ML" class="btn btn-outline-primary">
                                    <i class="fas fa-cogs me-2"></i> Preprocess Data
                                </a>



                                @* <div class=" mb-3"> *@
                                @*     <label class="form-label">ImageUploadFile</label> *@
                                @*     <input type="file" class="form-control" id="ImageUploadFile" /> *@
                                @* </div> *@
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
           $(document).ready(function() {
            $('#predictSalaryBtn').click(function() {
                // Clear previous messages
                $('#predictionInfo').html('').removeClass('text-danger text-success');
                $('.is-invalid').removeClass('is-invalid');

                // Collect form data
                var formData = {
                    Age: $('#Age').val(),
                    Experience: $('#Experience').val(),
                    Education: $('#Education').val(),
                    Skills: $('#Skills').val(),
                    Gender: $('#Gender').val(),
                    EmployementType: $('#EmployementType').val(),
                    Country: $('#Country').val()
                };

                // Client-side validation
                let isValid = true;
                if (!formData.Age || formData.Age < 18 || formData.Age > 70) {
                    $('#Age').addClass('is-invalid');
                    isValid = false;
                }
                if (!formData.Experience || formData.Experience < 0 || formData.Experience > 50) {
                    $('#Experience').addClass('is-invalid');
                    isValid = false;
                }
                ['Education', 'Skills', 'Gender', 'EmployementType', 'Country'].forEach(field => {
                    if (!formData[field]) {
                        $(`#${field}`).addClass('is-invalid');
                        isValid = false;
                    }
                });

                if (!isValid) {
                    $('#predictionInfo').html('Please correct the highlighted fields.').addClass('text-danger');
                    return;
                }

                // Show loading
                $('#predictionInfo').html('<i class="fas fa-spinner fa-spin"></i> Predicting salary...').addClass('text-info');

                // Call prediction endpoint
                $.ajax({
                    url: '@Url.Action("PredictSalary", "Employes")',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(formData),
                    success: function(response) {
                        if (response.success) {
                            $('#predictionInfo').html(`Predicted salary (${response.method}): ${response.predictedSalary}`)
                                                .addClass('text-success');

                            if (confirm(`Use predicted salary: ${response.predictedSalary}?`)) {
    document.getElementById('salaryInput').value = response.predictedSalary.replace(/[^0-9.]/g, '');
}
                        } else {
                            $('#predictionInfo').html('Error: ' + response.message).addClass('text-danger');
                        }
                    },
                    error: function(xhr) {
                        let errorMessage = "Error predicting salary. Please try again.";
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            errorMessage = xhr.responseJSON.message;
                        }
                        $('#predictionInfo').html(errorMessage).addClass('text-danger');
                    }
                });
            });
        });


                    const ImageUploadFile=document.getElementById("ImageUploadFile");
           async function  ImageUploadFilefun(e)
           {
             // console.log(e.target.files[0])
             let data = new FormData();
             data.append("file",e.target.files[0]);
           await fetch("api/Image",
             {
                 method:"POST",
                 headers:{
                     "accept":"*/*",
                 },
                 body:data

             }).then(response=>response.json()).then
             (result=>{
                 console.log(result);
             })
          }
        ImageUploadFile.addEventListener("change",ImageUploadFilefun);

    </script>
}